<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formato de Canalización</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');
    *{
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Inter", sans-serif;
    }
    body {
      background-color: aliceblue;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .aside{
      height: 100vh;
      width: 300px;
      padding: 10px;
      background: #dee1e6;
      color: rgb(0, 0, 0);
      position: fixed;
      transition: all .4s ease;
    }
    .head{
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 50px;
      margin-bottom: 30px;
    }
    .head img{
      width: 50px;
      border-radius: 50%;
    }
    .head ion-icon {
      font-size: 30px;
      cursor: pointer;
    }
    .profile{
      display: flex;
      align-items: center;
    }
    .profile img {
      margin-right: 10px;
    }
    .options div{
      display: flex;
      align-items: center;
      padding: 15px;
      cursor: pointer;
      margin-bottom: 5px;
      border-radius: 10px;
      font-size: 1.1rem;
    }
    .options div:hover{
      background-color: rgba(255,255,255,0.254);
      transition: all .4s ease-in-out;
    }
    .options ion-icon{
      font-size: 1.4rem;
      margin-right: 10px;
    }
    /*MODIFICADORES AL CERRAR EL MENU*/
    .aside.active{
      width: 70px;
      transition: all .4s ease;
    }
    .aside.active .option,
    .aside.active .profile{
      display: none;
    }
    .aside.active .head ion-icon{
      margin: auto;
    }
    .aside.active .options ion-icon{
      margin: auto;
    }
    footer {
      background: #dee1e6;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 5px;
      gap: 20px;
      color: rgb(0, 0, 0);
      height: 80;
    }
    ion-icon{
      color: #000000;
    }
    .footer-center i {
      margin: 0 8px;
      font-size: 100px;
      color: #000000;
    }
    .contenido {
      flex: 1;
    }
    .texto{
        width: 200px;
        height: 50px;
        justify-content: center;
        align-items: center;
        position: obsulute;
        padding-left: 60px;
    }
    .titulo{
      text-align: center;
      margin-top: 20px;
    }
    h2{
      margin-bottom: 15px;
    }
    .options a {
      text-decoration: none;
      color: black;         
    }

    .options a:hover {
      color: #226c41;
    }
    :root{
      --bg:#f6f8fb;
      --card:#ffffff; 
      --accent:#0f62fe; 
      --muted:#6b7280; 
      --radius:12px;
      --shadow: 0 6px 18px rgba(12,20,40,0.08);
    }
    *{
        box-sizing:border-box
    }
    body {
      background-color: aliceblue;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .wrap {
      width: 95%;
        max-width:1200px;
        margin:28px auto;
        padding:20px
    }
    header { 
        display:flex;
        align-items:center;
        justify-content:space-between;
        margin-bottom:18px
    }
    .brand { 
        display:flex;
        gap:12px;
        align-items:center
    }
    .logo { 
        width:88px;
        height:88px;
        border-radius:8px;
        background:white;
        display:flex;
        align-items:center;
        justify-content:center;
        color:white;
        font-weight:700
    }
    h1 {
        font-size:18px;
        margin:0
    }
    p.lead {
        margin:0;
        color:var(--muted);
        font-size:13px
    }

    form.card {
        background:var(--card);
        padding:18px;
        border-radius:var(--radius);
        box-shadow:var(--shadow)
    }
    .row {
        display:flex;
        gap:12px;
        margin-bottom:12px
    }
    .col {
        flex:1
    }
    label {
        display:block;
        font-size:13px;
        color:black;
        margin-bottom:6px
    }
    input[type='text'], input[type='date'], input[type='tel'], textarea, select, input[type='time']{
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid #e6e9ef;
      font-size:14px;
      outline:none;
      background:#fff
    }
    textarea {
        min-height:84px;
        resize:vertical
    }
    .obs-grid {
        display:grid;
        grid-template-columns:1fr 120px;
        gap:10px;
        align-items:start
    }
    .obs-item {
        display:flex;
        gap:8px
    }
    .small {
        font-size:12px;
        color:var(--muted)
    }
    .actions {
        display:flex;
        gap:8px;
        margin-top:14px
    }
    button {
        background:#226c41;
        color:white;
        border:0;
        padding:10px 14px;
        border-radius:10px;
        cursor:pointer;
        font-weight:600
    }
    button:hover {
        background:#f76c00;
    }
    .signature {
        margin-top:10px;
        border-top:1px dashed #e6e9ef;
        padding-top:8px
    }
    .logo img {
        width: 70px;
        height: auto;
    }
      .modal {
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-contenido {
  background: white;
  padding: 30px;
  border-radius: 10px;
  text-align: center;
  max-width: 300px;
  width: 100%;
}

.modal-botones {
  margin-top: 20px;
  display: flex;
  justify-content: space-between;
}

.modal-botones button {
  padding: 10px 20px;
  font-size: 14px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

#confirmarBtn {
  background-color: #226c41;
  color: white;
}

#cancelarBtn {
  background-color: #d9534f;
  color:white;
}
.mensaje-error {
  color: red;
  font-size: 13px;
  margin-top: -5px;
  margin-bottom: 10px;
}

 @media (max-width:720px){.row{flex-direction:column}.obs-grid{grid-template-columns:1fr 1fr}}
/* RESPONSIVO */
@media screen and (max-width: 768px) {
  .aside {
    position: relative;
    width: 100%;
    height: auto;
  }

  .aside.active {
    width: 100%;
  }

  .contenido {
    margin-left: 0;
  }

  .formulario {
    padding: 15px;
  }

  .formulario-grid {
    flex-direction: column;
    gap: 10px;
  }

  footer {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .footer-left img {
    width: 100px;
    padding-left: 0;
  }

  .modal-contenido {
    width: 90%;
    max-width: 90%;
  }
}

@media screen and (max-width: 480px) {
  .formulario-footer button {
    width: 100%;
  }
}

/* Ajuste del contenido respecto al menú lateral */
.contenido {
  flex: 1;
  margin-left: 300px;
  transition: margin-left 0.4s ease;
}
.aside.active ~ .contenido {
  margin-left: 70px;
}
  </style>
</head>
<body>
  <aside class="aside active" id="aside">
    <div class="head">
      <div class="profile">
        <img src="Logoo.png" alt="Logo">
        <p>SIEAP</p>
      </div>
      <ion-icon name="menu-outline" id="menu-outline"></ion-icon>
    </div>
    <div class="options">
      <div>
        <a href="Listas.html"><ion-icon name="journal-outline"></ion-icon></a>
        <a href="Listas.html" class="option">Lista de tutorados</a>
      </div>
      <div>
        <a href="Asistencias.html"><ion-icon name="create-outline"></ion-icon></a>
        <a href="Asistencias.html" class="option">Asistencias</a>
      </div>
      <div>
        <a href="Obsercaciones.html"><ion-icon name="eye-outline"></ion-icon></a>
        <a href="Obsercaciones.html" class="option">Observaciones</a>
      </div>
      <div>
        <a href="agenda.html"><ion-icon name="calendar-outline"></ion-icon></a>
        <a href="agenda.html" class="option">Agendar Cita</a>
      </div>
      <div>
        <a href="Canalizaciones.html"><ion-icon name="documents-outline"></ion-icon></a>
        <a href="Canalizaciones.html" class="option">Canalizaciones</a>
      </div>
    </div>
    </aside>
  <div class="wrap">
    <form id="canalizacion" class="card" onsubmit="return false;">
        <div class="brand">
        <div class="logo">
            <img src="Logoo.png" alt="Logo UTTX">
        </div>
        <div>
          <h1>Formato de Canalización</h1>
          <p class="lead">Rellene los campos y use "Imprimir/Guardar" para generar versión física</p>
        </div>
      </div>
      
      <div class="row">
        <div class="col">
          <label>Nombre de la carrera</label>
          <select id="carrera" name="carrera" class="form-control" required>
            <option value="">Selecciona carrera</option>
            <option value="TI-DSM">TI-DSM</option>
            <option value="TI-YRD">TI-YRD</option>
            <option value="TI-EVND">TI-EVND</option>
            <option value="IDGS">IDGS</option>
            <option value="IRIC">IRIC</option>
            <option value="IEVND">IEVND</option>
            <option value="ITII">ITII</option>
          </select>
          <div class="mensaje-error" id="err-carrera"></div>
        </div>
        <div>
          <label>Fecha</label>
          <input id="fecha" name="fecha" type="date" class="form-control" required />
          <div class="mensaje-error" id="err-fecha"></div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>Nombre del tutorado</label>
          <input id="nombre" type="text" placeholder="Nombre completo" />
          <div class="mensaje-error" id="err-nombre"></div>
        </div>
        <div style="width:140px">
          <label>Cuatrimestre</label>
          <select id="cuatri">
            <option value="">Cuatrimestre</option>
            <option>Mayo-Agosto</option>
            <option>Septiembre-Diciembre</option>
            <option>Enero-Abril</option>
          </select>
          <div class="mensaje-error" id="err-cuatri"></div>
        </div>
        <div style="width:160px">
          <label>Matrícula</label>
          <input id="matricula" type="text" placeholder="Ej. A1234" />
          <div class="mensaje-error" id="err-matricula"></div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>Teléfono del tutorado</label>
          <input id="telefono" type="tel" placeholder="10 dígitos" maxlength="10" />
          <div class="mensaje-error" id="err-telefono"></div>
        </div>
        <div class="col">
          <label>Canaliza</label>
          <input id="canaliza" type="text" placeholder="Quién canaliza / área" />
          <div class="mensaje-error" id="err-canaliza"></div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>Nombre de la materia</label>
          <input id="materia" type="text" />
          <div class="mensaje-error" id="err-materia"></div>
        </div>
        <div class="col">
          <label>Motivo de canalización</label>
          <input id="motivo" type="text" />
          <div class="mensaje-error" id="err-motivo"></div>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid #eef2f7;margin:14px 0" />

      <label>Conductas observadas (indique por lo menos seis conductas y el tiempo que las presenta)</label>
      <div style="display:grid;gap:8px;margin-top:8px">
        <div class="obs-grid"><input id="c1" type="text" placeholder="1.- Conducta" /><input id="t1" type="text" placeholder="Tiempo" /></div>
        <div class="obs-grid"><input id="c2" type="text" placeholder="2.- Conducta" /><input id="t2" type="text" placeholder="Tiempo" /></div>
        <div class="obs-grid"><input id="c3" type="text" placeholder="3.- Conducta" /><input id="t3" type="text" placeholder="Tiempo" /></div>
        <div class="obs-grid"><input id="c4" type="text" placeholder="4.- Conducta" /><input id="t4" type="text" placeholder="Tiempo" /></div>
        <div class="obs-grid"><input id="c5" type="text" placeholder="5.- Conducta" /><input id="t5" type="text" placeholder="Tiempo" /></div>
        <div class="obs-grid"><input id="c6" type="text" placeholder="6.- Conducta" /><input id="t6" type="text" placeholder="Tiempo" /></div>
        <div class="mensaje-error" id="err-conductas"></div>
      </div>

      <div style="margin-top:12px">
        <label>Acciones que ha implementado hasta el momento para intervenir</label>
        <textarea id="acciones" placeholder="Describa las acciones que se han realizado..."></textarea>
        <div class="mensaje-error" id="err-acciones"></div>
      </div>

      <div class="actions">
        <button id="btnCargar" type="button">Cargar datos</button>
        <button id="btnGuardar" type="button">Guardar</button>
        <button id="btnLimpiar" type="button">Limpiar</button>
        <button id="btnImprimir" type="button">Imprimir</button>
      </div>

    </form>
</div>
    <footer>
      <div class="footer-left">
        <p>Universidad Tecnológica de Tlaxcala</p>
        <img src="logoSieap.png" alt="Sieap" class="texto">
      </div>
    </footer>
  <div id="modalConfirmacion" style="display: none;" class="modal">
    <div class="modal-contenido">
      <p>¿Deseas guardar los cambios?</p>
      <div class="modal-botones">
        <button id="confirmarBtn">Sí</button>
        <button class="cerrar-modal">No</button>
      </div>
    </div>
  </div>
   <div id="modalLimpiar" style="display: none;" class="modal">
    <div class="modal-contenido">
      <p>¿Deseas limpiar los campos?</p>
      <div class="modal-botones">
        <button id="confirmarLimpiar">Sí</button>
        <button class="cerrar-modal">No</button>
      </div>
    </div>
  </div>
   <div id="modalCargar" style="display: none;" class="modal">
    <div class="modal-contenido">
      <p>¿Deseas cargar datos?</p>
      <div class="modal-botones">
        <button id="confirmarCargar">Sí</button>
        <button class="cerrar-modal">No</button>
      </div>
    </div>
  </div>

  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <script>
    // ====== Menú lateral ======
    const aside = document.getElementById('aside');
    const menu = document.getElementById('menu-outline');
    menu.onclick = () => { aside.classList.toggle('active'); };

    // ====== Modales reutilizables ======
    const modalConfirmacion = document.getElementById("modalConfirmacion");
    const modalCargar = document.getElementById("modalCargar");
    const modalLimpiar = document.getElementById("modalLimpiar");

    let accionPendiente = null;

    function mostrarModal(tipo) {
      accionPendiente = tipo;
      if (tipo === "guardar") modalConfirmacion.style.display = "flex";
      if (tipo === "cargar") modalCargar.style.display = "flex";
      if (tipo === "limpiar") modalLimpiar.style.display = "flex";
    }
    function cerrarModales() {
      modalConfirmacion.style.display = "none";
      modalCargar.style.display = "none";
      modalLimpiar.style.display = "none";
    }

    // Cerrar por click en "No"
    document.querySelectorAll('.cerrar-modal').forEach(btn => {
      btn.addEventListener('click', cerrarModales);
    });

    // Botones de confirmación por modal
    document.getElementById('confirmarBtn').addEventListener('click', () => { if (accionPendiente === 'guardar') { guardarDatos(); } cerrarModales(); });
    document.getElementById('confirmarCargar').addEventListener('click', () => { if (accionPendiente === 'cargar') { cargarDatos(); } cerrarModales(); });
    document.getElementById('confirmarLimpiar').addEventListener('click', () => { if (accionPendiente === 'limpiar') { limpiarCampos(); } cerrarModales(); });

    // ====== VALIDACIONES DE CARACTERES ======
    const REGEX = {
      letras: /[^A-Za-zÁÉÍÓÚÜÑáéíóúüñ\s]/g,               // solo letras y espacios
      letrasNL: /[^A-Za-zÁÉÍÓÚÜÑáéíóúüñ\s\n]/g,           // letras + espacios + saltos de línea
      alnum: /[^A-Za-z0-9]/g,                              // matrícula: letras y números
      digitos: /[^0-9]/g                                   // teléfono: solo números
    };

    function filtrarEntrada(el, tipo) {
      const antes = el.value;
      el.value = el.value.replace(REGEX[tipo], '');
      return antes !== el.value; // true si hubo limpieza
    }

    function marcarError(id, msg) {
      const div = document.getElementById('err-' + id);
      if (div) div.textContent = msg || '';
    }

    function attachFiltro(id, tipo, opciones = {}) {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener('input', () => {
        const limpio = filtrarEntrada(el, tipo);
        if (opciones.toUppercase) el.value = el.value.toUpperCase();
        if (limpio) marcarError(id, 'Se eliminaron caracteres no permitidos.');
        else marcarError(id, '');
        if (id === 'telefono') {
          // fuerza longitud máxima 10 y evita espacios
          el.value = el.value.replace(/\s/g, '').slice(0, 10);
        }
      });
      el.addEventListener('blur', () => {
        if (opciones.required && !el.value.trim()) {
          marcarError(id, 'Este campo es obligatorio.');
        } else if (id === 'telefono' && el.value.length > 0 && el.value.length !== 10) {
          marcarError(id, 'El teléfono debe tener 10 dígitos.');
        } else {
          marcarError(id, '');
        }
      });
    }

    // Campos con SOLO LETRAS
    ['nombre','canaliza','materia','motivo','c1','c2','c3','c4','c5','c6'].forEach(id => attachFiltro(id, 'letras', { required:true }));
    // Acciones (permite saltos de línea)
    attachFiltro('acciones', 'letrasNL', { required:true });
    // Matrícula (alfanumérico, opcionalmente en mayúsculas)
    attachFiltro('matricula', 'alnum', { required:true, toUppercase:true });
    // Teléfono (solo dígitos y exactamente 10)
    attachFiltro('telefono', 'digitos', { required:true });

    // ====== Validación integral previo a guardar ======
    function validarFormulario() {
      let ok = true;
      const reqIds = ['carrera','fecha','nombre','cuatri','matricula','telefono','canaliza','materia','motivo','acciones'];
      reqIds.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        if (!el.value || !el.value.trim()) {
          const errId = document.getElementById('err-' + id);
          if (errId) errId.textContent = 'Este campo es obligatorio.';
          ok = false;
        }
      });
      // Teléfono 10 dígitos
      const tel = document.getElementById('telefono');
      if (tel && tel.value.replace(/\D/g,'').length !== 10) {
        marcarError('telefono','El teléfono debe tener 10 dígitos.');
        ok = false;
      }
      // Al menos 3 conductas con algo escrito
      const conductas = ['c1','c2','c3',];
      const vacias = conductas.filter(id => !document.getElementById(id).value.trim());
      if (vacias.length) { document.getElementById('err-conductas').textContent = 'Completa las por lo menos 3 conductas.'; ok = false; }
      else { document.getElementById('err-conductas').textContent = ''; }
      return ok;
    }

    // ====== Persistencia (LocalStorage) ======
    function guardarDatos() {
      if (!validarFormulario()) { return; }
      const data = {};
      ['carrera','fecha','nombre','cuatri','matricula','telefono','canaliza','materia','motivo',
       'c1','t1','c2','t2','c3','t3','c4','t4','c5','t5','c6','t6','acciones','fechaCita','horaInicio','horaFin','coordinador']
      .forEach(id=> {
        const el = document.getElementById(id);
        if (el) data[id] = el.value;
      });
      localStorage.setItem('form_canalizacion', JSON.stringify(data));
    }

    function cargarDatos() {
      const raw = localStorage.getItem('form_canalizacion');
      if (!raw) {; return; }
      const data = JSON.parse(raw);
      Object.keys(data).forEach(k => {
        const el = document.getElementById(k);
        if (el) el.value = data[k];
      });
    //alert('Datos cargados correctamente.');
    }


    function limpiarCampos() {
      ['carrera','fecha','nombre','cuatri','matricula','telefono','canaliza','materia','motivo',
       'c1','t1','c2','t2','c3','t3','c4','t4','c5','t5','c6','t6','acciones','fechaCita','horaInicio','horaFin','coordinador']
      .forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = '';
      });
      // borra mensajes
      document.querySelectorAll('.mensaje-error').forEach(n => n.textContent = '');
    }

    // ====== Imprimir en una sola hoja y ocultar el aside ======
    function imprimir() {
      const estiloOriginal = document.body.innerHTML;
      const estiloImpresion = `
        <style>
          @page { size: A4; margin: 10mm; }
          body { -webkit-print-color-adjust: exact; font-family: Arial, sans-serif; }
          aside { display: none !important; }
          footer { display: none !important; }
          .main-container { margin: 0; padding: 0; }
          .button { display: none !important; }
          .wrap { width: 100%; max-width: none; margin: 0; padding: 0; }
          .actions { display: none !important; }
        </style>
      `;
      const contenido = document.body.cloneNode(true);
      const asideClonado = contenido.querySelector("aside");
      if (asideClonado) asideClonado.remove();
      document.body.innerHTML = estiloImpresion + contenido.innerHTML;
      window.print();
      document.body.innerHTML = estiloOriginal;
      location.reload();
    }

    // ====== Eventos de botones principales ======
    document.getElementById("btnGuardar").addEventListener("click", () => mostrarModal("guardar"));
    document.getElementById("btnCargar").addEventListener("click", () => mostrarModal("cargar"));
    document.getElementById("btnLimpiar").addEventListener("click", () => mostrarModal("limpiar"));
    document.getElementById("btnImprimir").addEventListener("click", imprimir);
  </script>
  <script>
    const carrera = document.getElementById('carrera');
    const fecha = document.getElementById('fecha');

    function validarCamposObligatorios() {
      let valido = true;

      if (!carrera.value.trim()) {
        document.getElementById('err-carrera').textContent = "Este campo es obligatorio.";
        valido = false;
      } else {
        document.getElementById('err-carrera').textContent = "";
      }

      if (!fecha.value.trim()) {
        document.getElementById('err-fecha').textContent = "Este campo es obligatorio.";
        valido = false;
      } else {
        document.getElementById('err-fecha').textContent = "";
      }

      return valido;
    }

    // Dentro de guardarDatos()
    if (!validarCamposObligatorios()) return;
    const cuatri = document.getElementById('cuatri');

    function validarCamposObligatorios() {
      let valido = true;

      // Validar carrera
      if (!carrera.value.trim()) {
        document.getElementById('err-carrera').textContent = "Este campo es obligatorio.";
        valido = false;
      } else {
        document.getElementById('err-carrera').textContent = "";
      }

      // Validar fecha
      if (!fecha.value.trim()) {
        document.getElementById('err-fecha').textContent = "Este campo es obligatorio.";
        valido = false;
      } else {
        document.getElementById('err-fecha').textContent = "";
      }

      // Validar matrícula
      if (!matricula.value.trim()) {
        document.getElementById('err-matricula').textContent = "Este campo es obligatorio.";
        valido = false;
      } else {
        document.getElementById('err-matricula').textContent = "";
      }

      // Validar cuatrimestre
      if (!cuatri.value.trim()) {
        document.getElementById('err-cuatri').textContent = "Este campo es obligatorio.";
        valido = false;
      } else {
        document.getElementById('err-cuatri').textContent = "";
      }

      return valido;
    }

  </script>
</body>
</html>